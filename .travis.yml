os:
  - linux
language: ruby
sudo: required
dist: trusty

addons:
  apt:
    sources:
    - google-chrome
    packages:
    - google-chrome-stable
  packages:
    - unzip

before_install:
  - sh ./install_latest_gauge.sh /tmp
  - source ~/.profile
  - gauge --install ruby
  - bundle install
  - wget https://bintray.com/artifact/download/gauge/activeadmin-demo/activeadmin-demo.war
  - java -version
  - java -jar activeadmin-demo.war &
  - sleep 30
  - sudo apt-get install unzip
  - wget -q -O - https://dl-ssl.google.com/linux/linux_signing_key.pub | sudo apt-key add -
  - sudo apt-get update
  - sudo apt-get install -y libappindicator1 fonts-liberation
  - wget https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb
  - sudo dpkg -f google-chrome*.deb
  - sudo apt-get -f install
  - wget -N http://chromedriver.storage.googleapis.com/2.30/chromedriver_linux64.zip -P ~/Downloads
  - unzip ~/Downloads/chromedriver_linux64.zip -d ~/Downloads
  - chmod +x ~/Downloads/chromedriver
  - sudo mv -f ~/Downloads/chromedriver /usr/bin/chromedriver
  - npm install --global surge
  - sudo apt-get install xvfb
  - Xvfb :0 -ac -screen 0 1024x768x24 &

install:
  - headless=Y bundle exec gauge specs
  
after_success:
  - cd ./reports/html-report 
  - surge

after_failure:
  - cd ./reports/html-report 
  - surge
